<!DOCTYPE html>
<html>

<head>
    <link rel="icon" type="image/png" href="https://em-content.zobj.net/source/apple/271/robot_1f916.png">
    <title>Insect Fact Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #18191A;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 90%;
            background-color: #242526;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 0 auto;
        }

        /* Media query for mobile devices */
        @media screen and (max-width: 600px) {
            .container {
                width: 97%;
                max-width: none;
                border-radius: 0;
                box-shadow: none;
                padding: 10px;
            }
        }

        h1 {
            text-align: center;
            color: #E4E6EB;
        }

        .chat-box {
            background-color: #3A3B3C;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 20px;
            position: relative;
        }

        #fact {
            font-size: 16px;
            line-height: 1.5;
            color: #E4E6EB
        }

        #cursor {
            display: inline-block;
            width: 5px;
            height: 1em;
            background-color: #18191A;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0% {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        #image {
            text-align: center;
            margin-top: 20px;
        }

        #image-text {
            text-align: center;
            margin-top: 10px;
            color: #E4E6EB;
        }

        #image-credit {
            text-align: center;
            margin-top: 10px;
            color: #E4E6EB;
        }

        #loading {
            display: none;
            text-align: center;
            font-size: 18px;
            margin-top: 20px;
            color: #E4E6EB
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        @keyframes loading {
            0% {
                content: "⠋";
            }

            11.11% {
                content: "⠙";
            }

            22.22% {
                content: "⠹";
            }

            33.33% {
                content: "⠸";
            }

            44.44% {
                content: "⠼";
            }

            55.55% {
                content: "⠴";
            }

            66.66% {
                content: "⠦";
            }

            77.77% {
                content: "⠧";
            }

            88.88% {
                content: "⠇";
            }

            100% {
                content: "⠏";
            }
        }

        #loading::after {
            content: "⠋";
            animation: loading 1s linear infinite;
        }

        button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: #18191A;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #3A3B3C;
            color: #E4E6EB;
            padding: 16px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            z-index: 9999;
            transform: translateY(-20px);
            margin-bottom: 10px;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .notification-data {
            font-size: 14px;
        }

        .disclaimer-box {
            background-color: #B0B3B8;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .disclaimer-box p {
            margin: 0;
            font-size: 14px;
            color: #3A3B3C;
        }

        .local-storage-buttons {
            margin-top: 10px;
            display: flex;
            justify-content: center;
        }

        .local-storage-buttons button {
            margin: 0 10px;
            padding: 8px 16px;
            font-size: 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #acceptbtn {
            background-color: #3A3B3C;
            color: #E4E6EB;
        }

        #declinebtn {
            background-color: #3A3B3C;
            color: #E4E6EB;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Insect Fact Generator</h1>
        <div class="chat-box">
            <div id="fact"></div>
            <div id="cursor"></div>
        </div>
        <div class="image-container">
            <div id="image"></div>
            <div id="image-text"></div>
            <div id="image-credit"></div>
        </div>
        <div id="loading">
            <p><span id="loading-dots"></span></p>
        </div> <button id="generate-btn" onclick="generateFact()"><b>Tell me a fact about insects</b></button> <button
            id="regenerate-btn" style="display: none;" onclick="regenerateFact()"><b>Tell me another fact about
                insects</b></button>
        <div class="disclaimer-box" id='disclaimer-box'>
            <p>By using this website, you acknowledge and agree that we use your browser's "local storage" to store your
                previous responses locally on your device. These previous responses are sent to our server solely for
                the purpose of ensuring that no duplicate responses are provided. We do not store or retain any of your
                responses on our server and we do not store or collect any personal data. If you wish to clear your
                "local storage" from this website at any time, please <a href="#" onclick="clearlocalstorage()">click
                    here</a>. By continuing to use this website, you consent to the use of "local storage" as described
                above.</p>
            <div class="local-storage-buttons">
                <button id="acceptbtn" onclick="acceptlocalstorage()">Accept</button>
                <button id="declinebtn" onclick="declinelocalstorage()">Decline</button>
            </div>
        </div>
    </div>

    <script>
        let previousFacts = [];
        // Load previous facts from localStorage on page load
        window.addEventListener('load', function () {
            const storedFacts = localStorage.getItem('previousFacts');
            if (storedFacts) {
                previousFacts = JSON.parse(storedFacts);
            }
        });
        let notificationCount = 0;
        const notificationContainer = document.createElement('div');
        notificationContainer.style.position = 'fixed';
        notificationContainer.style.top = '20px';
        notificationContainer.style.right = '20px';
        document.body.appendChild(notificationContainer);

        function showNotification(title, data) {
            const notification = document.createElement('div');
            notification.classList.add('notification');

            const notificationTitle = document.createElement('div');
            notificationTitle.classList.add('notification-title');
            notificationTitle.textContent = title;

            const notificationData = document.createElement('div');
            notificationData.classList.add('notification-data');
            notificationData.textContent = data;

            notification.appendChild(notificationTitle);
            notification.appendChild(notificationData);

            notificationContainer.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notificationContainer.removeChild(notification);
                    updateNotificationPositions();
                }, 500);
            }, 10000);

            updateNotificationPositions();
        }

        function updateNotificationPositions() {
            const notifications = notificationContainer.children;
            for (let i = 0; i < notifications.length; i++) {
                notifications[i].style.transform = `translateY(${i * 90}px)`;
            }
        }

        function clearlocalstorage() {
            localStorage.removeItem('previousFacts');
            showNotification('Local Storage Cleared ✅', 'Your local storage from this website has been cleared!');
        }

        function acceptlocalstorage() {
            document.getElementById('disclaimer-box').style.display = 'none';
        }

        function declinelocalstorage() {
            clearlocalstorage();
            window.history.back();
        }

        function generateFact() {
            try {
                let prompt =
                    `<s>[INST] Give me a unique fact about a random insect of your choosing and how it is important in some way in order to increase insect awareness. [/INST]`;

                // Append previously generated facts to the prompt
                for (let i = 0; i < previousFacts.length; i++) {
                    prompt += ` ${previousFacts[i]}</s>`;
                }
                prompt +=
                    ` [INST] Give me a unique fact about a random insect of your choosing and how it is important in some way in order to increase insect awareness. [/INST]`

                document.getElementById('loading').style.display = 'block';
                document.getElementById('fact').innerHTML = '';
                document.getElementById('image').innerHTML = '';
                document.getElementById('image-text').innerHTML = '';
                document.getElementById('image-credit').innerHTML = '';
                document.getElementById('generate-btn').style.display = 'none';


                generateResponse("https://antibot.dev/generate-fact", prompt);
            } catch (error) {
                showNotification('Error ⚠️', error);
                document.getElementById('regenerate-btn').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        }

        function regenerateFact() {
            try {
                let prompt =
                    `<s>[INST] Give me a unique fact about a random insect of your choosing and how it is important in some way in order to increase insect awareness. [/INST]`;

                // Append previously generated facts to the prompt
                for (let i = 0; i < previousFacts.length; i++) {
                    prompt += ` ${previousFacts[i]}</s>`;
                }

                // Append the original prompt without the <s> tag
                prompt +=
                    ` [INST] Give me a unique fact about a random insect of your choosing and how it is important in some way in order to increase insect awareness. [/INST]`;

                document.getElementById('loading').style.display = 'block';
                document.getElementById('fact').innerHTML = '';
                document.getElementById('image').innerHTML = '';
                document.getElementById('image-text').innerHTML = '';
                document.getElementById('image-credit').innerHTML = '';
                document.getElementById('regenerate-btn').style.display = 'none';

                generateResponse("https://antibot.dev/generate-fact", prompt);
            } catch (error) {
                showNotification('Error ⚠️', error);
                document.getElementById('regenerate-btn').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        }
        async function generateResponse(apiUrl, prompt) {
    try {
        document.getElementById('loading').innerHTML = "Connecting to the server  ";

        // Create a hidden iframe to submit the challenge form
        const iframe = document.createElement('iframe');
        iframe.name = 'challenge_iframe';
        iframe.style.display = 'none';
        iframe.src = 'https://antibot.dev/challenges'; // Set the src attribute to the expected origin URL
        document.body.appendChild(iframe);

        // Listen for the load event from the iframe
        iframe.addEventListener('load', () => {
            const iframeDocument = iframe.contentWindow.document;
            console.log(iframeDocument)
            console.log(event)
            // You can add further checks here if needed
            handleChallengeResponse();
        }, false);

        // Function to handle the response from /challenges
        function handleChallengeResponse() {
            document.getElementById('loading').innerHTML = "Solving JavaScript challenge  ";

            // Decode the base64-encoded challenge code
            const encodedChallengeCode = iframe.contentWindow.token;
            const decodedChallengeCode = atob(encodedChallengeCode);

            // Evaluate the decoded challenge code
            eval(decodedChallengeCode);
        }

        // Wait for the token to be available
        while (typeof token === 'undefined') {
            await new Promise(resolve => setTimeout(resolve, 100));
        }

        document.getElementById('loading').innerHTML = "Generating insect fact  ";

        // Proceed with generating the response using the token
        const controller = new AbortController();
        const timeoutId = setTimeout(() => {
            controller.abort();
            showNotification('Timeout ⚠️', 'The request is taking longer than expected. Please try again.');
        }, 90000);

        // Create a form to submit the request
        const form = document.createElement('form');
        form.action = apiUrl;
        form.method = 'POST';
        form.target = 'challenge_iframe'; // Set the target to the iframe
        document.body.appendChild(form);

        // Create input fields for the prompt and token
        const promptInput = document.createElement('input');
        promptInput.type = 'hidden';
        promptInput.name = 'prompt';
        promptInput.value = prompt;
        form.appendChild(promptInput);

        const tokenInput = document.createElement('input');
        tokenInput.type = 'hidden';
        tokenInput.name = 'token';
        tokenInput.value = token;
        form.appendChild(tokenInput);

        // Submit the form
        form.submit();

        // Clean up
        clearTimeout(timeoutId);
        document.getElementById('loading').style.display = 'none';

    } catch (error) {
        showNotification('Error ⚠️', error);
        document.getElementById('regenerate-btn').style.display = 'block';
        document.getElementById('loading').style.display = 'none';
    }
}

async function generateImage(fact, token) {
            try {
                // Proceed with generating the image
                const controller = new AbortController();
                const timeoutId2 = setTimeout(() => {
                    controller.abort();
                    showNotification('Timeout ⚠️',
                        'The request is taking longer than expected. Please try again.');
                }, 90000);
                axios.post('https://antibot.dev/generate-image', {
                        fact: fact,
                        token: token // Include the token in the request body
                    }, {
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        signal: controller.signal
                    })
                    .then(response => {
                        clearTimeout(timeoutId2);
                        if (response.data.photoURL.includes('https://pixabay.com')) {
                            document.getElementById('image').innerHTML = '<img src="' + response.data.photoURL +
                                '" alt="Insect Image">';
                            document.getElementById('image-text').innerText = 'Inferenced Insect Name: ' +
                                response.data
                                .inferencedData;
                            document.getElementById('image-credit').innerHTML = '<a href="' + response.data
                                .photoCredit + '">' + response.data.photoCredit + '</a>';
                        } else {
                            showNotification('Error ⚠️', response.data.error);
                            document.getElementById('regenerate-btn').style.display = 'block';
                            document.getElementById('loading').style.display = 'none';
                        }
                    })
                    .catch(error => {
                        clearTimeout(timeoutId2);
                        showNotification('Error ⚠️', error);
                        document.getElementById('regenerate-btn').style.display = 'block';
                        document.getElementById('loading').style.display = 'none';
                    });
            } catch (error) {
                showNotification('Error ⚠️', error);
                document.getElementById('regenerate-btn').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        }

        function typeText(text) {
            let index = 0;
            const speed = 20;
            const typingEffect = () => {
                if (index < text.length) {
                    document.getElementById('fact').innerHTML += text.charAt(index);
                    index++;
                    setTimeout(typingEffect, speed);
                } else {
                    document.getElementById('regenerate-btn').style.display = 'block';
                }
            };
            document.getElementById('cursor').style.display = 'none';
            typingEffect();
        }
    </script>
</body>

</html>
