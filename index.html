<!DOCTYPE html>
<html>

<head>
    <link rel="icon" type="image/png" href="https://em-content.zobj.net/source/apple/271/robot_1f916.png">
    <title>Insect Fact Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #18191A;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 90%;
            background-color: #242526;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 0 auto;
        }

        /* Media query for mobile devices */
        @media screen and (max-width: 600px) {
            .container {
                width: 97%;
                max-width: none;
                border-radius: 0;
                box-shadow: none;
                padding: 10px;
            }
        }

        h1 {
            text-align: center;
            color: #E4E6EB;
        }

        .chat-box {
            background-color: #3A3B3C;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 20px;
            position: relative;
        }

        #fact {
            font-size: 16px;
            line-height: 1.5;
            color: #E4E6EB
        }

        #cursor {
            display: inline-block;
            width: 5px;
            height: 1em;
            background-color: #18191A;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0% {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        #image {
            text-align: center;
            margin-top: 20px;
        }

        #image-text {
            text-align: center;
            margin-top: 10px;
            color: #E4E6EB;
        }

        #image-credit {
            text-align: center;
            margin-top: 10px;
            color: #E4E6EB;
        }

        #loading {
            display: none;
            text-align: center;
            font-size: 18px;
            margin-top: 20px;
            color: #E4E6EB
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        @keyframes loading {
0% {
content: "⠋";
}
11.11% {
content: "⠙";
}
22.22% {
content: "⠹";
}
33.33% {
content: "⠸";
}
44.44% {
content: "⠼";
}
55.55% {
content: "⠴";
}
66.66% {
content: "⠦";
}
77.77% {
content: "⠧";
}
88.88% {
content: "⠇";
}
100% {
content: "⠏";
}
}

        #loading::after {
            content: "⠋";
            animation: loading 1s linear infinite;
        }

        button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: #18191A;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #3A3B3C;
            color: #E4E6EB;
            padding: 16px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            z-index: 9999;
            transform: translateY(-20px);
            margin-bottom: 10px;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .notification-data {
            font-size: 14px;
        }

        .disclaimer-box {
            background-color: #B0B3B8;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .disclaimer-box p {
            margin: 0;
            font-size: 14px;
            color: #3A3B3C;
        }

        .local-storage-buttons {
            margin-top: 10px;
            display: flex;
            justify-content: center;
        }

        .local-storage-buttons button {
            margin: 0 10px;
            padding: 8px 16px;
            font-size: 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #acceptbtn {
            background-color: #3A3B3C;
            color: #E4E6EB;
        }

        #declinebtn {
            background-color: #3A3B3C;
            color: #E4E6EB;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Insect Fact Generator</h1>
        <div class="chat-box">
            <div id="fact"></div>
            <div id="cursor"></div>
        </div>
        <div class="image-container">
            <div id="image"></div>
            <div id="image-text"></div>
            <div id="image-credit"></div>
        </div>
        <div id="loading">
            <p>Generating Insect Fact<span id="loading-dots"></span></p>
        </div> <button id="generate-btn" onclick="generateFact()"><b>Tell me a fact about insects</b></button> <button
            id="regenerate-btn" style="display: none;" onclick="regenerateFact()"><b>Tell me another fact about
                insects</b></button>
        <div class="disclaimer-box" id='disclaimer-box'>
            <p>By using this website, you acknowledge and agree that we use your browser's "local storage" to store your
                previous responses locally on your device. These previous responses are sent to our server solely for
                the purpose of ensuring that no duplicate responses are provided. We do not store or retain any of your
                responses on our server and we do not store or collect any personal data. If you wish to clear your
                "local storage" from this website at any time, please <a href="#" onclick="clearlocalstorage()">click
                    here</a>. By continuing to use this website, you consent to the use of "local storage" as described
                above.</p>
            <div class="local-storage-buttons">
                <button id="acceptbtn" onclick="acceptlocalstorage()">Accept</button>
                <button id="declinebtn" onclick="declinelocalstorage()">Decline</button>
            </div>
        </div>
    </div>

    <script>
        let previousFacts = [];
        // Load previous facts from localStorage on page load
        window.addEventListener('load', function () {
            const storedFacts = localStorage.getItem('previousFacts');
            if (storedFacts) {
                previousFacts = JSON.parse(storedFacts);
            }
        });
        let notificationCount = 0;
        const notificationContainer = document.createElement('div');
        notificationContainer.style.position = 'fixed';
        notificationContainer.style.top = '20px';
        notificationContainer.style.right = '20px';
        document.body.appendChild(notificationContainer);

        function showNotification(title, data) {
            const notification = document.createElement('div');
            notification.classList.add('notification');

            const notificationTitle = document.createElement('div');
            notificationTitle.classList.add('notification-title');
            notificationTitle.textContent = title;

            const notificationData = document.createElement('div');
            notificationData.classList.add('notification-data');
            notificationData.textContent = data;

            notification.appendChild(notificationTitle);
            notification.appendChild(notificationData);

            notificationContainer.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notificationContainer.removeChild(notification);
                    updateNotificationPositions();
                }, 500);
            }, 10000);

            updateNotificationPositions();
        }

        function updateNotificationPositions() {
            const notifications = notificationContainer.children;
            for (let i = 0; i < notifications.length; i++) {
                notifications[i].style.transform = `translateY(${i * 90}px)`;
            }
        }

        function clearlocalstorage() {
            localStorage.removeItem('previousFacts');
            showNotification('Local Storage Cleared ✅', 'Your local storage from this website has been cleared!');
        }

        function acceptlocalstorage() {
            document.getElementById('disclaimer-box').style.display = 'none';
        }

        function declinelocalstorage() {
            clearlocalstorage();
            window.history.back();
        }

        function generateFact() {
            try {
                let prompt =
                    `<s>[INST] Give me a unique fact about a random insect of your choosing and how it is important in some way in order to increase insect awareness. [/INST]`;

                // Append previously generated facts to the prompt
                for (let i = 0; i < previousFacts.length; i++) {
                    prompt += ` ${previousFacts[i]}</s>`;
                }
                prompt +=
                    ` [INST] Give me a unique fact about a random insect of your choosing and how it is important in some way in order to increase insect awareness. [/INST]`

                document.getElementById('loading').style.display = 'block';
                document.getElementById('fact').innerHTML = '';
                document.getElementById('image').innerHTML = '';
                document.getElementById('image-text').innerHTML = '';
                document.getElementById('image-credit').innerHTML = '';
                document.getElementById('generate-btn').style.display = 'none';

                    
                    generateResponse("https://insectserver-qse3.onrender.com/generate-fact", {
                        "prompt": prompt
                    }, '')
            } catch (error) {
                showNotification('Error ⚠️', error);
                document.getElementById('regenerate-btn').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        }

        function regenerateFact() {
            try {
                let prompt =
                    `<s>[INST] Give me a unique fact about a random insect of your choosing and how it is important in some way in order to increase insect awareness. [/INST]`;

                // Append previously generated facts to the prompt
                for (let i = 0; i < previousFacts.length; i++) {
                    prompt += ` ${previousFacts[i]}</s>`;
                }

                // Append the original prompt without the <s> tag
                prompt +=
                    ` [INST] Give me a unique fact about a random insect of your choosing and how it is important in some way in order to increase insect awareness. [/INST]`;

                document.getElementById('loading').style.display = 'block';
                document.getElementById('fact').innerHTML = '';
                document.getElementById('image').innerHTML = '';
                document.getElementById('image-text').innerHTML = '';
                document.getElementById('image-credit').innerHTML = '';
                document.getElementById('regenerate-btn').style.display = 'none';

                generateResponse("https://insectserver-qse3.onrender.com/generate-fact", {
                    "prompt": prompt
                }, '');
            } catch (error) {
                showNotification('Error ⚠️', error);
                document.getElementById('regenerate-btn').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        }
        async function generateResponse(apiUrl, prompt, previousResponse) {
            try {
                // Check if the cookie exists
                const cookieExists = document.cookie.includes('token=');

                if (!cookieExists) {
                    // Cookie doesn't exist, fetch the list of challenges from the server
                    const response = await fetch('https://insectserver-qse3.onrender.com/challenges');
                    const challenges = await response.json();

                    // Execute each challenge and store the result
                    const results = [];
                    for (const challenge of challenges) {
                        const deobfuscatedCode = challenge.exec
                            .replace(/\$/g, 'a')
                            .replace(/\#/g, 'e')
                            .replace(/\*/g, 'i')
                            .replace(/\%/g, 'o')
                            .replace(/\^/g, 'u');
                        const result = eval(deobfuscatedCode);
                        results.push({ index: challenge.index, result });
                    }

                    // Send the challenge results to the server for validation
                    const validationResponse = await fetch('https://insectserver-qse3.onrender.com/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: `challenge-id={{challengeId}}&challenge-result=${encodeURIComponent(btoa(JSON.stringify(results)))}`
                    });

                    if (!validationResponse.ok) {
                        // Challenges failed, handle the error
                        showNotification('Browser Verification Failed 🤖', 'Please ensure that javascript is enabled!');
                        document.getElementById('regenerate-btn').style.display = 'block';
                        document.getElementById('loading').style.display = 'none';
                        return;
                    }
                }

                // ... (rest of the code remains the same) ...
            } catch (error) {
                showNotification('Error ⚠️', error);
                document.getElementById('regenerate-btn').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function generateImage(fact) {
            try {
                // Check if the cookie exists
                const cookieExists = document.cookie.includes('token=');

                if (!cookieExists) {
                    // Cookie doesn't exist, fetch the list of challenges from the server
                    const response = await fetch('https://insectserver-qse3.onrender.com/challenges');
                    const challenges = await response.json();

                    // Execute each challenge and store the result
                    const results = [];
                    for (const challenge of challenges) {
                        const deobfuscatedCode = challenge.exec
                            .replace(/\$/g, 'a')
                            .replace(/\#/g, 'e')
                            .replace(/\*/g, 'i')
                            .replace(/\%/g, 'o')
                            .replace(/\^/g, 'u');
                        const result = eval(deobfuscatedCode);
                        results.push({ index: challenge.index, result });
                    }

                    // Send the challenge results to the server for validation
                    const validationResponse = await fetch('https://insectserver-qse3.onrender.com/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: `challenge-id={{challengeId}}&challenge-result=${encodeURIComponent(btoa(JSON.stringify(results)))}`
                    });

                    if (!validationResponse.ok) {
                        // Challenges failed, handle the error
                        showNotification('Browser Verification Failed 🤖', 'Please ensure that javascript is enabled!');
                        document.getElementById('regenerate-btn').style.display = 'block';
                        document.getElementById('loading').style.display = 'none';
                        return;
                    }
                }

                // ... (rest of the code remains the same) ...
            } catch (error) {
                showNotification('Error ⚠️', error);
                document.getElementById('regenerate-btn').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        }

        function typeText(text) {
            let index = 0;
            const speed = 20;
            const typingEffect = () => {
                if (index < text.length) {
                    document.getElementById('fact').innerHTML += text.charAt(index);
                    index++;
                    setTimeout(typingEffect, speed);
                } else {
                    document.getElementById('regenerate-btn').style.display = 'block';
                }
            };
            document.getElementById('cursor').style.display = 'none';
            typingEffect();
        }

        
        </script>
</body>

</html>
